---
import Base from "./Base.astro"
import { sidebar } from "../data/sidebar"

interface Props {
  title: string
  description?: string
}

const { title, description } = Astro.props

const currentPath = Astro.url.pathname
const normalizePath = (path: string) => {
  if (!path) return "/"
  const normalized = path.replace(/\/$/, "")
  return normalized === "" ? "/" : normalized
}
const isActive = (path: string) => normalizePath(currentPath) === normalizePath(path)
const getHref = (item: { slug?: string; link?: string }) => {
  if (item.link) return item.link
  if (!item.slug || item.slug === "index") return "/"
  return `/${item.slug}`
}
---

<Base title={title} description={description}>
  <div class="docs-page">
    <div class="docs-container">
      <header class="header">
        <div class="header-content">
          <a href="/" class="logo">
            <img class="logo-icon" src="/favicon.svg" alt="@danielfrg/ui" />
            @danielfrg/ui
          </a>
          <button
            class="mobile-menu-btn"
            aria-label="Open navigation menu"
            aria-expanded="false"
            aria-controls="mobile-nav"
          >
            <svg class="menu-icon" viewBox="0 0 24 24" fill="currentColor">
              <rect x="5" y="8" width="14" height="2"></rect>
              <rect x="5" y="14" width="14" height="2"></rect>
            </svg>
            <svg class="close-icon" viewBox="0 0 24 24" fill="currentColor">
              <rect x="5" y="11" width="14" height="2" transform="rotate(45 12 12)"></rect>
              <rect x="5" y="11" width="14" height="2" transform="rotate(-45 12 12)"></rect>
            </svg>
          </button>
          <nav class="nav">
            <a href="https://github.com/danielfrg/ui" target="_blank" rel="noopener noreferrer">GitHub</a>
            <a href="/examples/">Examples</a>
          </nav>
        </div>
      </header>

      <main class="main">
        <div class="mobile-nav-overlay" aria-hidden="true"></div>
        <div class="docs-layout">
          <aside class="sidebar" id="mobile-nav">
            {sidebar.map((section) => (
              <div class="sidebar-section">
                <div class="sidebar-title">{section.title}</div>
                <ul class="sidebar-links">
                  {section.items.map((item) => {
                    const href = getHref(item)
                    return (
                      <li>
                        <a href={href} class:list={{ active: isActive(href) }}>
                          {item.label}
                        </a>
                      </li>
                    )
                  })}
                </ul>
              </div>
            ))}
          </aside>

          <article class="content">
            <slot />
          </article>
        </div>
      </main>

      <footer class="footer">
        <div class="footer-content">
          <span>@danielfrg/ui - SolidJS UI components</span>
          <a href="https://github.com/danielfrg/ui" target="_blank" rel="noopener noreferrer">GitHub</a>
        </div>
      </footer>
    </div>
  </div>

  <script>
    const menuBtn = document.querySelector('.mobile-menu-btn')
    const sidebar = document.querySelector('.sidebar')
    const overlay = document.querySelector('.mobile-nav-overlay')

    function openMenu() {
      document.body.classList.add('mobile-nav-open')
      menuBtn?.setAttribute('aria-expanded', 'true')
      menuBtn?.setAttribute('aria-label', 'Close navigation menu')
    }

    function closeMenu() {
      document.body.classList.remove('mobile-nav-open')
      menuBtn?.setAttribute('aria-expanded', 'false')
      menuBtn?.setAttribute('aria-label', 'Open navigation menu')
    }

    menuBtn?.addEventListener('click', () => {
      const isOpen = document.body.classList.contains('mobile-nav-open')
      if (isOpen) {
        closeMenu()
      } else {
        openMenu()
      }
    })

    overlay?.addEventListener('click', closeMenu)

    document.addEventListener('keydown', (e) => {
      if (e.key === 'Escape' && document.body.classList.contains('mobile-nav-open')) {
        closeMenu()
      }
    })

    sidebar?.querySelectorAll('a').forEach((link) => {
      link.addEventListener('click', closeMenu)
    })

    document.querySelectorAll('.content table').forEach((table) => {
      const wrapper = document.createElement('div')
      wrapper.className = 'table-wrapper'
      table.parentNode?.insertBefore(wrapper, table)
      wrapper.appendChild(table)
    })

    document.querySelectorAll('pre').forEach((pre) => {
      const btn = document.createElement('button')
      btn.className = 'copy-btn'
      btn.setAttribute('aria-label', 'Copy code')
      btn.innerHTML = `
        <svg class="copy-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
          <rect x="9" y="9" width="13" height="13" rx="2" ry="2"></rect>
          <path d="M5 15H4a2 2 0 0 1-2-2V4a2 2 0 0 1 2-2h9a2 2 0 0 1 2 2v1"></path>
        </svg>
        <svg class="check-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
          <polyline points="20 6 9 17 4 12"></polyline>
        </svg>
      `
      pre.appendChild(btn)

      btn.addEventListener('click', async () => {
        const code = pre.dataset.code || pre.textContent || ''
        await navigator.clipboard.writeText(code)
        btn.classList.add('copied')
        setTimeout(() => btn.classList.remove('copied'), 1500)
      })
    })
  </script>
</Base>
